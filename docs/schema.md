# Документація схеми бази даних

## Загальний опис

У курсовій роботі реалізовано серверну частину інтернет-магазину з використанням
реляційної бази даних PostgreSQL.  
Для роботи з базою даних застосовується Prisma ORM, що дозволяє описувати схему
даних декларативно та забезпечує типобезпечний доступ до БД.

Схема бази даних спроєктована з урахуванням вимог нормалізації, цілісності даних,
масштабованості та підтримки бізнес-логіки проєкту.

---

## ERD (Entity-Relationship Diagram)

У базі даних використовуються такі основні сутності:

- User — користувачі системи  
- Category — категорії товарів  
- Product — товари  
- ProductPriceHistory — історія зміни цін  
- Order — замовлення  
- OrderItem — позиції товарів у замовленнях  
- Review — відгуки користувачів  

### Основні зв’язки:
- User → Order (один-до-багатьох)
- Order → OrderItem (один-до-багатьох)
- Product → OrderItem (один-до-багатьох)
- Category → Product (один-до-багатьох)
- Product → ProductPriceHistory (один-до-багатьох)
- User → Review (один-до-багатьох)
- Product → Review (один-до-багатьох)

---

## Опис таблиць

### Таблиця: User

Призначення:  
Зберігає інформацію про користувачів системи.

| Стовпець | Тип | Обмеження | Опис |
|--------|-----|----------|------|
| id | Int | PK, autoincrement | Унікальний ідентифікатор |
| email | String | UNIQUE, NOT NULL | Email користувача |
| passwordHash | String | NOT NULL | Хеш пароля |
| isActive | Boolean | DEFAULT true | Статус активності |
| createdAt | DateTime | DEFAULT now() | Дата створення |
| updatedAt | DateTime | auto-update | Дата оновлення |
| deletedAt | DateTime | NULL | Soft delete |

Зв’язки:  
- один користувач може мати кілька замовлень  
- один користувач може залишати кілька відгуків  

---

### Таблиця: Category

Призначення:  
Зберігає категорії товарів.

| Стовпець | Тип | Обмеження | Опис |
|--------|-----|----------|------|
| id | Int | PK | Ідентифікатор категорії |
| name | String | UNIQUE | Назва категорії |
| createdAt | DateTime | DEFAULT now() | Дата створення |

Зв’язки:  
- одна категорія містить багато товарів  

---

### Таблиця: Product

Призначення:  
Зберігає інформацію про товари інтернет-магазину.

| Стовпець | Тип | Обмеження | Опис |
|--------|-----|----------|------|
| id | Int | PK | Ідентифікатор товару |
| name | String | NOT NULL | Назва товару |
| sku | String | UNIQUE | Артикул |
| price | Decimal | NOT NULL | Поточна ціна |
| stock | Int | DEFAULT 0 | Кількість на складі |
| isActive | Boolean | DEFAULT true | Активність товару |
| version | Int | DEFAULT 1 | Версія (optimistic locking) |
| createdAt | DateTime | DEFAULT now() | Дата створення |
| updatedAt | DateTime | auto-update | Дата оновлення |
| deletedAt | DateTime | NULL | Soft delete |
| categoryId | Int | FK | Категорія товару |

Індекси:  
- індекс за categoryId  
- індекс за price  

---

### Таблиця: ProductPriceHistory

Призначення:  
Зберігає історію змін цін товарів.

| Стовпець | Тип | Опис |
|--------|-----|------|
| id | Int | PK |
| productId | Int | FK на Product |
| oldPrice | Decimal | Попередня ціна |
| newPrice | Decimal | Нова ціна |
| changedAt | DateTime | Час зміни |

---

### Таблиця: Order

Призначення:  
Зберігає замовлення користувачів.

| Стовпець | Тип | Опис |
|--------|-----|------|
| id | Int | PK |
| userId | Int | FK на User |
| status | Enum | Статус замовлення |
| total | Decimal | Загальна сума |
| version | Int | Optimistic locking |
| createdAt | DateTime | Дата створення |
| updatedAt | DateTime | Дата оновлення |

---

### Таблиця: OrderItem

Призначення:  
Зберігає позиції товарів у замовленнях.

| Стовпець | Тип | Опис |
|--------|-----|------|
| id | Int | PK |
| orderId | Int | FK на Order |
| productId | Int | FK на Product |
| quantity | Int | Кількість товару |
| unitPrice | Decimal | Ціна на момент покупки |

---

### Таблиця: Review

Призначення:  
Зберігає відгуки користувачів про товари.

| Стовпець | Тип | Опис |
|--------|-----|------|
| id | Int | PK |
| rating | Int | Оцінка |
| comment | String | Коментар |
| createdAt | DateTime | Дата створення |
| userId | Int | FK на User |
| productId | Int | FK на Product |

---

## Рішення щодо дизайну

- Схема відповідає 3-й нормальній формі
- Використано soft delete для збереження історії даних
- Реалізовано optimistic locking для конкурентних оновлень
- Індекси додані для оптимізації частих запитів
- Історія змін цін винесена в окрему таблицю для аналітики

---

## Висновок

Спроєктована схема бази даних забезпечує коректну роботу основних бізнес-процесів
інтернет-магазину, є масштабованою та придатною для подальшого розвитку системи.